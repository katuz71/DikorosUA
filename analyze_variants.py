import sqlite3
import json

conn = sqlite3.connect('shop.db')
cursor = conn.cursor()

print("=" * 120)
print("üìä –ê–ù–ê–õ–Ü–ó –¢–û–í–ê–†–Ü–í –ó –í–ê–†–Ü–ê–ù–¢–ê–ú–ò")
print("=" * 120)

# –í—Å—ñ —Ç–æ–≤–∞—Ä–∏
cursor.execute('SELECT id, name, price, category, variants, option_names FROM products')
all_products = cursor.fetchall()

print(f"\nüî¢ –í—Å—å–æ–≥–æ —Ç–æ–≤–∞—Ä—ñ–≤: {len(all_products)}\n")

# –ì—Ä—É–ø—É–≤–∞–Ω–Ω—è –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ–≥–æ —Ä–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è
print("=" * 120)
print("üîÑ –¢–û–í–ê–†–ò –î–õ–Ø –ê–í–¢–û–ú–ê–¢–ò–ß–ù–û–ì–û –ì–†–£–ü–£–í–ê–ù–ù–Ø (–∑–∞ –Ω–∞–∑–≤–æ—é)")
print("=" * 120)

auto_group = {}
for p in all_products:
    if not p[4]:  # –ù–µ–º–∞—î —Ä—É—á–Ω–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤
        # –í–∏—Ç—è–≥—É—î–º–æ –±–∞–∑–æ–≤—É –Ω–∞–∑–≤—É (–¥–æ –ø–µ—Ä—à–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç—É)
        name = p[1]
        base_name = name
        
        # –°–ø—Ä–æ—â–µ–Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è –±–∞–∑–æ–≤–æ—ó –Ω–∞–∑–≤–∏
        for keyword in ['–®–ª—è–ø–∫–∏', '–ú–µ–ª–µ–Ω–∏–π', '–ó–µ—Ä–Ω–æ–º—ñ—Ü–µ–ª—ñ–π', '–ü–æ—Ä–æ—à–æ–∫', '–¶—ñ–ª—ñ']:
            if keyword in name:
                base_name = name.split(keyword)[0].strip()
                break
        
        if base_name not in auto_group:
            auto_group[base_name] = []
        auto_group[base_name].append(p)

for base_name, variants in auto_group.items():
    if len(variants) > 1:
        print(f"\nüì¶ {base_name}")
        print(f"   –í–∞—Ä—ñ–∞–Ω—Ç—ñ–≤: {len(variants)}")
        for v in variants:
            print(f"   - {v[1]} ‚Üí {v[2]} –≥—Ä–Ω")

# –¢–æ–≤–∞—Ä–∏ –∑ —Ä—É—á–Ω–∏–º–∏ –≤–∞—Ä—ñ–∞–Ω—Ç–∞–º–∏
print("\n" + "=" * 120)
print("üé® –¢–û–í–ê–†–ò –ó –†–£–ß–ù–ò–ú–ò –í–ê–†–Ü–ê–ù–¢–ê–ú–ò")
print("=" * 120)

cursor.execute('SELECT id, name, price, category, variants, option_names FROM products WHERE variants IS NOT NULL AND variants != ""')
manual_products = cursor.fetchall()

for p in manual_products:
    print(f"\nüì¶ {p[1]} (ID: {p[0]})")
    print(f"   –ö–∞—Ç–µ–≥–æ—Ä—ñ—è: {p[3]}")
    print(f"   –ë–∞–∑–æ–≤–∞ —Ü—ñ–Ω–∞: {p[2]} –≥—Ä–Ω")
    print(f"   –û–ø—Ü—ñ—ó: {p[5]}")
    
    if p[4]:
        try:
            variants = json.loads(p[4])
            print(f"   –í–∞—Ä—ñ–∞–Ω—Ç—ñ–≤: {len(variants)}")
            for v in variants:
                print(f"   - {v['name']} ‚Üí {v['price']} –≥—Ä–Ω")
        except Exception as e:
            print(f"   ‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥—É: {e}")

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä—ñ—è—Ö
print("\n" + "=" * 120)
print("üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –ö–ê–¢–ï–ì–û–†–Ü–Ø–•")
print("=" * 120)

cursor.execute('SELECT category, COUNT(*) FROM products GROUP BY category')
categories = cursor.fetchall()

for cat in categories:
    print(f"   {cat[0]}: {cat[1]} —Ç–æ–≤–∞—Ä—ñ–≤")

# –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó
print("\n" + "=" * 120)
print("üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–Ü–á")
print("=" * 120)

print("""
1. –ê–í–¢–û–ú–ê–¢–ò–ß–ù–ï –ì–†–£–ü–£–í–ê–ù–ù–Ø –ø—Ä–∞—Ü—é—î –¥–ª—è —Ç–æ–≤–∞—Ä—ñ–≤ —Ç–∏–ø—É:
   - "–ú—É—Ö–æ–º–æ—Ä –ß–µ—Ä–≤–æ–Ω–∏–π –®–ª—è–ø–∫–∏ 100 –≥"
   - "–á–∂–æ–≤–∏–∫ –ì—Ä–µ–±—ñ–Ω—á–∞—Å—Ç–∏–π –ó–µ—Ä–Ω–æ–º—ñ—Ü–µ–ª—ñ–π 50 –≥"
   
   –°–∏—Å—Ç–µ–º–∞ —Ä–æ–∑–ø—ñ–∑–Ω–∞—î: —Ñ–æ—Ä–º—É (–®–ª—è–ø–∫–∏, –ú–µ–ª–µ–Ω–∏–π), —Ñ–∞—Å—É–≤–∞–Ω–Ω—è (50 –≥, 100 –≥), —Ä—ñ–∫

2. –†–£–ß–ù–Ü –í–ê–†–Ü–ê–ù–¢–ò –ø–æ—Ç—Ä—ñ–±–Ω—ñ –¥–ª—è:
   - –°–∫–ª–∞–¥–Ω–∏—Ö –∫–æ–º–±—ñ–Ω–∞—Ü—ñ–π (—Ç–∏–ø + –∫—ñ–ª—å–∫—ñ—Å—Ç—å)
   - –ù–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ (—Å–º–∞–∫, –∫–æ–ª—ñ—Ä, –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü—ñ—è)
   - –ö–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–µ–Ω –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç—Ä–æ–ª—å

3. –ù–ê–°–¢–£–ü–ù–Ü –ö–†–û–ö–ò:
   ‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–∏—Ö –≥–æ—Ç–æ–≤–∞ –∑ –ø—Ä–∏–∫–ª–∞–¥–∞–º–∏ –æ–±–æ—Ö –ø—ñ–¥—Ö–æ–¥—ñ–≤
   ‚úÖ –°–∏—Å—Ç–µ–º–∞ –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –≤ services/database.ts
   ‚úÖ UI –¥–ª—è –≤–∏–±–æ—Ä—É –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –≤ app/product/[id].tsx
   
   üîß –ü–æ—Ç—Ä—ñ–±–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏:
   - –†–æ–±–æ—Ç—É –≥—Ä—É–ø—É–≤–∞–Ω–Ω—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É –¥–æ–¥–∞—Ç–∫—É
   - –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –≤ –∫–∞—Ä—Ç–æ—á—Ü—ñ —Ç–æ–≤–∞—Ä—É
   - –ü—Ä–∞–≤–∏–ª—å–Ω—ñ—Å—Ç—å —Ä–æ–∑—Ä–∞—Ö—É–Ω–∫—É —Ü—ñ–Ω
""")

conn.close()

# Аналіз Системи Варіантів Товарів

## 📊 Поточний Стан Бази Даних

### Структура Таблиці `products`
```sql
CREATE TABLE products (
    id INTEGER PRIMARY KEY AUTOINCREMENT, 
    name TEXT, 
    price INTEGER, 
    discount INTEGER DEFAULT 0, 
    image TEXT, 
    images TEXT,
    category TEXT, 
    pack_sizes TEXT, 
    old_price REAL, 
    unit TEXT DEFAULT "шт",
    description TEXT,
    usage TEXT,
    delivery_info TEXT,
    return_info TEXT,
    variants TEXT,           -- JSON масив варіантів
    option_names TEXT        -- Назви опцій через "|"
)
```

### Поточні Товари (4 шт)
1. **Мухомор Червоний (Капелюшки)** - 800 грн (Сушені гриби)
2. **Їжовик Гребінчастий (Зерноміцелій)** - 650 грн (Сушені гриби)
3. **Мухомор Пантерний (Капсули)** - 1200 грн (Мікродозинг)
4. **Кордицепс Мілітаріс (Power+)** - 950 грн (Мікродозинг)

**Проблема:** Жоден товар не має варіантів (variants = NULL, option_names = NULL)

---

## 🎯 Система Варіантів

### 1. Автоматичне Групування (services/database.ts)

Система вже має **інтелектуальне групування** товарів за назвою через функцію `normalizeProduct()`:

#### Розпізнавані Атрибути:
- **Врожай (year)**: 2023, 2024, 2025
- **Сорт (sort)**: 1 сорт, 2 сорт, Вищий сорт, Еліт, Elite, Grade A
- **Форма (form)**: Мелений, Цілі, Капсули, Порошок, Без обробки, Шляпки, Зерномицелій
- **Фасування (weight)**: 100 г, 1 кг, 60 капсул, 100 мл

#### Приклад Роботи:
```
Вхід: "Мухомор Червоний Шляпки 100 г 2024"
Вихід:
  baseName: "Мухомор Червоний"
  attributes: {
    year: "2024",
    form: "Шляпки",
    weight: "100 г"
  }
```

#### Групи Варіантів (variationGroups):
```javascript
[
  { id: 'year', title: 'Врожай', options: ['2025', '2024', '2023'] },
  { id: 'form', title: 'Форма продукту', options: ['Мелений', 'Цілі', 'Шляпки'] },
  { id: 'sort', title: 'Сорт', options: ['1 сорт', '2 сорт', 'Вищий сорт'] },
  { id: 'weight', title: 'Фасування', options: ['50 г', '100 г', '250 г', '500 г'] }
]
```

### 2. Ручне Налаштування (variants + option_names)

Для товарів з **нестандартними варіантами** використовується матричний підхід:

#### Формат:
```json
// option_names (через "|")
"Колір|Розмір|Матеріал"

// variants (JSON масив)
[
  { "name": "Червоний|S|Бавовна", "price": 500, "image": "url1.jpg" },
  { "name": "Синій|M|Поліестер", "price": 550, "image": "url2.jpg" },
  { "name": "Зелений|L|Бавовна", "price": 600, "image": "url3.jpg" }
]
```

---

## 🔧 Реалізація в UI (app/product/[id].tsx)

### Поточна Логіка:

1. **Завантаження товару** - з контексту або локальної БД
2. **Парсинг варіантів** - з JSON або рядка
3. **Матричний селектор** - створення UI для вибору опцій
4. **Пошук варіанту** - `getVariantByOptions()` знаходить відповідний варіант
5. **Оновлення ціни** - динамічна зміна при виборі варіанту

### Приклад UI:
```
┌─────────────────────────────────┐
│ Мухомор Червоний                │
│ від 450 грн                     │
├─────────────────────────────────┤
│ Врожай:                         │
│ [2025] [2024] [2023]           │
├─────────────────────────────────┤
│ Форма продукту:                 │
│ [Шляпки] [Мелений] [Цілі]      │
├─────────────────────────────────┤
│ Фасування:                      │
│ [50 г] [100 г] [250 г] [500 г] │
├─────────────────────────────────┤
│ Ціна: 650 грн                   │
│ [Додати в кошик]                │
└─────────────────────────────────┘
```

---

## 📋 План Впровадження

### Етап 1: Розширення Seed Даних ✅
- Додати товари з різними варіантами
- Використати обидва підходи (автоматичний + ручний)

### Етап 2: Тестування Групування
- Перевірити роботу `normalizeProduct()`
- Переконатися що варіанти правильно групуються

### Етап 3: Покращення UI
- Додати візуальні індикатори доступності
- Покращити UX вибору варіантів
- Додати попередній перегляд зображень

### Етап 4: Валідація
- Перевірити всі комбінації варіантів
- Тестування на реальних даних

---

## 🎨 Рекомендації

### Для Автоматичного Групування:
✅ Використовувати стандартні назви: "Товар Форма Фасування Рік"
✅ Приклад: "Мухомор Червоний Шляпки 100 г 2024"

### Для Ручного Налаштування:
✅ Складні варіанти (колір, смак, комплектація)
✅ Товари з унікальними характеристиками
✅ Коли потрібен повний контроль над варіантами

### Комбінований Підхід:
⚡ Базові товари - автоматичне групування
⚡ Преміум товари - ручне налаштування з детальними описами

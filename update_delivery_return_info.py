#!/usr/bin/env python3
"""
–ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç–µ –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
"""

import requests
import json

API_URL = "http://localhost:8000"

DELIVERY_INFO = """–ë–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫–∞:
- –ù–æ–≤–æ—é –ø–æ—à—Ç–æ—é –≤—ñ–¥ 1500 –≥—Ä–Ω
- –£–∫—Ä–ø–æ—à—Ç–æ—é –≤—ñ–¥ 1000 –≥—Ä–Ω

–í—ñ–¥–ø—Ä–∞–≤–∫–∞:
–ü–æ—Å–∏–ª–∫–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—é—Ç—å—Å—è —â–æ–¥–Ω—è –ø—ñ—Å–ª—è 19:00 (—É —Å—É–±–æ—Ç—É —Ç–∞ –Ω–µ–¥—ñ–ª—é –ø—ñ—Å–ª—è 18:00)

–Ü–Ω—à—ñ –ø–µ—Ä–µ–≤—ñ–∑–Ω–∏–∫–∏:
–ó–∞ –¥–æ–º–æ–≤–ª–µ–Ω—ñ—Å—Ç—é

–û–ø–ª–∞—Ç–∞:
- –ë–∞–Ω–∫—ñ–≤—Å—å–∫–∏–π –ø–µ—Ä–µ–∫–∞–∑ (–ü—Ä–∏–≤–∞—Ç–±–∞–Ω–∫/–ú–æ–Ω–æ–±–∞–Ω–∫)
- –ì–æ—Ç—ñ–≤–∫–æ—é –∫—É—Ä'—î—Ä–æ–º
- –ü—ñ—Å–ª—è–ø–ª–∞—Ç–∞ –ø—Ä–∏ –æ—Ç—Ä–∏–º–∞–Ω–Ω—ñ (–∑–∞ –Ω–∞—à —Ä–∞—Ö—É–Ω–æ–∫)
- –Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –∑–∞ –∑–∞–ø–∏—Ç–æ–º

–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å—É–º–∞ –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è: 200 –≥—Ä–Ω"""

RETURN_INFO = """–£–º–æ–≤–∏ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è:
–ú–∏ –¥—É–∂–µ —Å—Ç–µ–∂–∏–º–æ –∑–∞ —è–∫—ñ—Å—Ç—é —Ç–æ–≤–∞—Ä—ñ–≤. –Ø–∫—â–æ —â–æ—Å—å –Ω–µ —Å–ø–æ–¥–æ–±–∞—î—Ç—å—Å—è, —É –≤–∞—Å —î 14 –¥–Ω—ñ–≤ –¥–ª—è –æ–∑–Ω–∞–π–æ–º–ª–µ–Ω–Ω—è —ñ —â–µ 14 –¥–Ω—ñ–≤ –Ω–∞ –ø–µ—Ä–µ—Å–∏–ª–∫—É –≤ –æ–±–∏–¥–≤–∞ –±–æ–∫–∏. –ó–∞–≥–∞–ª–æ–º 28 –¥–Ω—ñ–≤ –∑ –¥–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è.

–í–∏–º–æ–≥–∏:
- –¢–æ–≤–∞—Ä –º–∞—î –±—É—Ç–∏ –≤ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω—ñ–π —É–ø–∞–∫–æ–≤—Ü—ñ
- –ü–æ—Å–ª—É–≥–∏ –ø–µ—Ä–µ—Å–∏–ª–∞–Ω–Ω—è –æ–ø–ª–∞—á—É—î –ø–æ–∫—É–ø–µ—Ü—å

–ù–∞—à–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω—ñ—Å—Ç—å:
–Ø–∫—â–æ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –º–∏ –¥–æ–ø—É—Å—Ç–∏–ª–∏ –ø–æ–º–∏–ª–∫—É/–Ω–µ—Ç–æ—á–Ω—ñ—Å—Ç—å/–±—Ä–∞–∫, —É—Å—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –≤—ñ–¥–±—É–≤–∞—é—Ç—å—Å—è –∑–∞ –Ω–∞—à —Ä–∞—Ö—É–Ω–æ–∫."""

def get_products():
    """–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤"""
    try:
        response = requests.get(f"{API_URL}/products", timeout=10)
        response.raise_for_status()
        return response.json()
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤: {e}")
        return []

def update_product(product_id: int, data: dict):
    """–û–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–≤–∞—Ä"""
    try:
        response = requests.put(
            f"{API_URL}/products/{product_id}",
            json=data,
            timeout=10
        )
        response.raise_for_status()
        return True
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ {product_id}: {e}")
        return False

def main():
    print("üöÄ –ú–∞—Å—Å–æ–≤–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –¥–æ—Å—Ç–∞–≤–∫–µ –∏ –≤–æ–∑–≤—Ä–∞—Ç–µ\n")
    
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã
    products = get_products()
    if not products:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã")
        return
    
    print(f"üì¶ –ù–∞–π–¥–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(products)}\n")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —á—Ç–æ –±—É–¥–µ–º –æ–±–Ω–æ–≤–ª—è—Ç—å
    print("üìù –ë—É–¥—É—Ç –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–ª—è:")
    print("   ‚Ä¢ delivery_info")
    print("   ‚Ä¢ return_info")
    print("\n" + "="*60)
    print("\nüí° –ü—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞ –¥–æ—Å—Ç–∞–≤–∫–∏:")
    print("-"*60)
    print(DELIVERY_INFO[:200] + "...")
    print("\nüí° –ü—Ä–µ–≤—å—é —Ç–µ–∫—Å—Ç–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞:")
    print("-"*60)
    print(RETURN_INFO[:200] + "...")
    print("\n" + "="*60)
    
    # –°–ø—Ä–∞—à–∏–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    confirm = input(f"\nüí° –û–±–Ω–æ–≤–∏—Ç—å {len(products)} —Ç–æ–≤–∞—Ä–æ–≤? (y/N): ")
    
    if confirm.lower() != 'y':
        print("‚ùå –û—Ç–º–µ–Ω–µ–Ω–æ")
        return
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä—ã
    print("\nüîÑ –ù–∞—á–∏–Ω–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ...\n")
    
    updated = 0
    failed = 0
    
    for i, product in enumerate(products, 1):
        product_id = product['id']
        product_name = product['name']
        
        print(f"[{i}/{len(products)}] {product_name[:50]}...", end=" ")
        
        # –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
        update_data = {
            **product,  # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
            'delivery_info': DELIVERY_INFO,
            'return_info': RETURN_INFO,
        }
        
        # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–≤–∞—Ä
        if update_product(product_id, update_data):
            print("‚úÖ")
            updated += 1
        else:
            print("‚ùå")
            failed += 1
    
    # –ò—Ç–æ–≥–∏
    print("\n" + "="*60)
    print(f"\nüìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã:")
    print(f"   ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–æ: {updated}")
    print(f"   ‚ùå –û—à–∏–±–æ–∫: {failed}")
    print(f"   üì¶ –í—Å–µ–≥–æ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–æ: {len(products)}")
    
    if updated > 0:
        print(f"\nüéâ –£—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ {updated} —Ç–æ–≤–∞—Ä–æ–≤!")
        print("\nüí° –¢–µ–ø–µ—Ä—å –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:")
        print("   npx expo start -c")

if __name__ == '__main__':
    main()
